name: CI
on:
  push:
    branches: master

jobs:
  generate_images:
    runs-on: ubuntu-latest
    env:
      PLANTUML_VERSION: 1.2021.1
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Install PlantUML
        run: |
          sudo apt-get update

          # Not using "apt-get install plantuml" because it's an old version
          sudo apt-get install default-jre-headless

          # Avoid Java logging "Created user preferences directory"
          mkdir -p ~/.java/.userPrefs

          wget -q -O "${GITHUB_WORKSPACE}/plantuml.jar" "https://repo1.maven.org/maven2/net/sourceforge/plantuml/plantuml/${PLANTUML_VERSION}/plantuml-${PLANTUML_VERSION}.jar"

      - name: Run PlantUML
        run: |
          java -Djava.awt.headless=true -jar "${GITHUB_WORKSPACE}/plantuml.jar" -o generated_images examples/*.puml

      - name: Commit Images
        run: |
          git add generated_images/*
          git commit -m "Update Generated Images"
          git push
